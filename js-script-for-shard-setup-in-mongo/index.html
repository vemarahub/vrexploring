<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>JS Script for Shard Setup in Mongo | VR Exploring</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="JS Script for Shard Setup in Mongo" />
<meta name="author" content="Rajesh Nair" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Instead of setting up each shard replica set and adding them to shard in the mongos shell we can use the below js script and load it to mongos to add mongo shards without much hassle: db = db.getSisterDB(&quot;config&quot;); var mongosConn = db; // assume we connected to a mongos to get going var res = null; function check() { &nbsp; &nbsp; &nbsp; &nbsp; printjson(res); &nbsp; &nbsp; &nbsp; &nbsp; if( !res || !res.ok ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw &quot;check(): not ok, stopping&quot;; &nbsp; &nbsp; &nbsp; &nbsp; } } function waitForSetHealthy() { &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;waiting for repl set initiate to complete...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; while( 1 ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep(250); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var res = rs.status(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !res.ok ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var bad = false; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var i = 0; i &lt; res.members.length; i++ ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var state = res.members[i].state; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( state != 1 &amp;&amp; state != 2 ) // primary or secondary? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !bad ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; &nbsp; &nbsp; &nbsp; &nbsp; } } function ourAddShard(setname,port) { &nbsp; &nbsp; &nbsp; &nbsp; db = connect(&quot;localhost:&quot;+port+&quot;/test&quot;); &nbsp; &nbsp; &nbsp; &nbsp; print(db.isMaster().me); &nbsp; &nbsp; &nbsp; &nbsp; res = rs.initiate( &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : setname, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;members&quot; : [ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 0, host: &quot;localhost:&quot; + port }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 1, host: &quot;localhost:&quot; + (port+1) }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 2, host: &quot;localhost:&quot; + (port+2) } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; ); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; waitForSetHealthy(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;adding shard...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; db = mongosConn; &nbsp; &nbsp; &nbsp; &nbsp; res = sh.addShard(setname+&quot;/localhost:&quot;+port); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;done; run sh.status()&quot;); } print(&quot;setup.js loaded.&quot;); print(&quot;list of existing shards before doing anything:&quot;); printjson( db.shards.find().toArray() ); print() print(&quot;You can invoke:&quot;); print(&quot;ourAddShard(setname,port)&quot;); print() Just save the js to a&nbsp;initiateShard.js file and load to the mongos &nbsp;mongo -shell initiateShard.js Now we can simple add any new shard replica set to existing shards by invoking: ourAddShard(setname,port) e g: &gt;ourAddShard(&quot;d&quot;,27300) connecting to: mongodb://localhost:27300/test Implicit session: session { &quot;id&quot; : UUID(&quot;666f3569-f12b-4d6b-87bf-58325ec616bb&quot;) } MongoDB server version: 4.0.6 [unknown type] { &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } waiting for repl set initiate to complete... adding shard... { &nbsp; &nbsp; &nbsp; &nbsp; &quot;shardAdded&quot; : &quot;d&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } done; run sh.status() If you run sh.status() after adding the shards you will get the below response: mongos&gt;sh.status() --- Sharding Status --- &nbsp; sharding version: { &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;minCompatibleVersion&quot; : 5, &nbsp; &nbsp; &nbsp; &nbsp; &quot;currentVersion&quot; : 6, &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterId&quot; : ObjectId(&quot;4c90af09e7e0f635a571e413&quot;) &nbsp; } &nbsp; shards: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;a&quot;,&nbsp; &quot;host&quot; : &quot;a/localhost:27000,localhost:27001,localhost:27002&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;b&quot;,&nbsp; &quot;host&quot; : &quot;b/localhost:27100,localhost:27101,localhost:27102&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;c&quot;,&nbsp; &quot;host&quot; : &quot;c/localhost:27200,localhost:27201,localhost:27202&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;d&quot;,&nbsp; &quot;host&quot; : &quot;d/localhost:27300,localhost:27301,localhost:27302&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; active mongoses: &nbsp; &nbsp; &nbsp; &nbsp; &quot;4.0.6&quot; : 4 &nbsp; autosplit: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled: yes &nbsp; balancer: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled:&nbsp; yes &nbsp; &nbsp; &nbsp; &nbsp; Currently running:&nbsp; no &nbsp; &nbsp; &nbsp; &nbsp; Failed balancer rounds in last 5 attempts:&nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; Migration Results for the last 24 hours: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No recent migrations &nbsp; databases: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;config&quot;,&nbsp; &quot;primary&quot; : &quot;config&quot;,&nbsp; &quot;partitioned&quot; : true }" />
<meta property="og:description" content="Instead of setting up each shard replica set and adding them to shard in the mongos shell we can use the below js script and load it to mongos to add mongo shards without much hassle: db = db.getSisterDB(&quot;config&quot;); var mongosConn = db; // assume we connected to a mongos to get going var res = null; function check() { &nbsp; &nbsp; &nbsp; &nbsp; printjson(res); &nbsp; &nbsp; &nbsp; &nbsp; if( !res || !res.ok ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw &quot;check(): not ok, stopping&quot;; &nbsp; &nbsp; &nbsp; &nbsp; } } function waitForSetHealthy() { &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;waiting for repl set initiate to complete...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; while( 1 ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep(250); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var res = rs.status(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !res.ok ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var bad = false; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var i = 0; i &lt; res.members.length; i++ ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var state = res.members[i].state; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( state != 1 &amp;&amp; state != 2 ) // primary or secondary? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !bad ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; &nbsp; &nbsp; &nbsp; &nbsp; } } function ourAddShard(setname,port) { &nbsp; &nbsp; &nbsp; &nbsp; db = connect(&quot;localhost:&quot;+port+&quot;/test&quot;); &nbsp; &nbsp; &nbsp; &nbsp; print(db.isMaster().me); &nbsp; &nbsp; &nbsp; &nbsp; res = rs.initiate( &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : setname, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;members&quot; : [ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 0, host: &quot;localhost:&quot; + port }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 1, host: &quot;localhost:&quot; + (port+1) }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 2, host: &quot;localhost:&quot; + (port+2) } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; ); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; waitForSetHealthy(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;adding shard...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; db = mongosConn; &nbsp; &nbsp; &nbsp; &nbsp; res = sh.addShard(setname+&quot;/localhost:&quot;+port); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;done; run sh.status()&quot;); } print(&quot;setup.js loaded.&quot;); print(&quot;list of existing shards before doing anything:&quot;); printjson( db.shards.find().toArray() ); print() print(&quot;You can invoke:&quot;); print(&quot;ourAddShard(setname,port)&quot;); print() Just save the js to a&nbsp;initiateShard.js file and load to the mongos &nbsp;mongo -shell initiateShard.js Now we can simple add any new shard replica set to existing shards by invoking: ourAddShard(setname,port) e g: &gt;ourAddShard(&quot;d&quot;,27300) connecting to: mongodb://localhost:27300/test Implicit session: session { &quot;id&quot; : UUID(&quot;666f3569-f12b-4d6b-87bf-58325ec616bb&quot;) } MongoDB server version: 4.0.6 [unknown type] { &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } waiting for repl set initiate to complete... adding shard... { &nbsp; &nbsp; &nbsp; &nbsp; &quot;shardAdded&quot; : &quot;d&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } done; run sh.status() If you run sh.status() after adding the shards you will get the below response: mongos&gt;sh.status() --- Sharding Status --- &nbsp; sharding version: { &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;minCompatibleVersion&quot; : 5, &nbsp; &nbsp; &nbsp; &nbsp; &quot;currentVersion&quot; : 6, &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterId&quot; : ObjectId(&quot;4c90af09e7e0f635a571e413&quot;) &nbsp; } &nbsp; shards: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;a&quot;,&nbsp; &quot;host&quot; : &quot;a/localhost:27000,localhost:27001,localhost:27002&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;b&quot;,&nbsp; &quot;host&quot; : &quot;b/localhost:27100,localhost:27101,localhost:27102&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;c&quot;,&nbsp; &quot;host&quot; : &quot;c/localhost:27200,localhost:27201,localhost:27202&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;d&quot;,&nbsp; &quot;host&quot; : &quot;d/localhost:27300,localhost:27301,localhost:27302&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; active mongoses: &nbsp; &nbsp; &nbsp; &nbsp; &quot;4.0.6&quot; : 4 &nbsp; autosplit: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled: yes &nbsp; balancer: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled:&nbsp; yes &nbsp; &nbsp; &nbsp; &nbsp; Currently running:&nbsp; no &nbsp; &nbsp; &nbsp; &nbsp; Failed balancer rounds in last 5 attempts:&nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; Migration Results for the last 24 hours: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No recent migrations &nbsp; databases: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;config&quot;,&nbsp; &quot;primary&quot; : &quot;config&quot;,&nbsp; &quot;partitioned&quot; : true }" />
<link rel="canonical" href="https://vemarahub.github.io/vrexploring/js-script-for-shard-setup-in-mongo/" />
<meta property="og:url" content="https://vemarahub.github.io/vrexploring/js-script-for-shard-setup-in-mongo/" />
<meta property="og:site_name" content="VR Exploring" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-29T14:12:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JS Script for Shard Setup in Mongo" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Rajesh Nair"},"dateModified":"2019-03-29T14:12:00+00:00","datePublished":"2019-03-29T14:12:00+00:00","description":"Instead of setting up each shard replica set and adding them to shard in the mongos shell we can use the below js script and load it to mongos to add mongo shards without much hassle: db = db.getSisterDB(&quot;config&quot;); var mongosConn = db; // assume we connected to a mongos to get going var res = null; function check() { &nbsp; &nbsp; &nbsp; &nbsp; printjson(res); &nbsp; &nbsp; &nbsp; &nbsp; if( !res || !res.ok ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw &quot;check(): not ok, stopping&quot;; &nbsp; &nbsp; &nbsp; &nbsp; } } function waitForSetHealthy() { &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;waiting for repl set initiate to complete...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; while( 1 ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep(250); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var res = rs.status(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !res.ok ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var bad = false; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var i = 0; i &lt; res.members.length; i++ ) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var state = res.members[i].state; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( state != 1 &amp;&amp; state != 2 ) // primary or secondary? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad = true; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !bad ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break; &nbsp; &nbsp; &nbsp; &nbsp; } } function ourAddShard(setname,port) { &nbsp; &nbsp; &nbsp; &nbsp; db = connect(&quot;localhost:&quot;+port+&quot;/test&quot;); &nbsp; &nbsp; &nbsp; &nbsp; print(db.isMaster().me); &nbsp; &nbsp; &nbsp; &nbsp; res = rs.initiate( &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : setname, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;members&quot; : [ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 0, host: &quot;localhost:&quot; + port }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 1, host: &quot;localhost:&quot; + (port+1) }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 2, host: &quot;localhost:&quot; + (port+2) } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; ); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; waitForSetHealthy(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;adding shard...&quot;); &nbsp; &nbsp; &nbsp; &nbsp; db = mongosConn; &nbsp; &nbsp; &nbsp; &nbsp; res = sh.addShard(setname+&quot;/localhost:&quot;+port); &nbsp; &nbsp; &nbsp; &nbsp; check(); &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;done; run sh.status()&quot;); } print(&quot;setup.js loaded.&quot;); print(&quot;list of existing shards before doing anything:&quot;); printjson( db.shards.find().toArray() ); print() print(&quot;You can invoke:&quot;); print(&quot;ourAddShard(setname,port)&quot;); print() Just save the js to a&nbsp;initiateShard.js file and load to the mongos &nbsp;mongo -shell initiateShard.js Now we can simple add any new shard replica set to existing shards by invoking: ourAddShard(setname,port) e g: &gt;ourAddShard(&quot;d&quot;,27300) connecting to: mongodb://localhost:27300/test Implicit session: session { &quot;id&quot; : UUID(&quot;666f3569-f12b-4d6b-87bf-58325ec616bb&quot;) } MongoDB server version: 4.0.6 [unknown type] { &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551107, 1), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } waiting for repl set initiate to complete... adding shard... { &nbsp; &nbsp; &nbsp; &nbsp; &quot;shardAdded&quot; : &quot;d&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &quot;ok&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;operationTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &quot;$clusterTime&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterTime&quot; : Timestamp(1284551121, 3), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;signature&quot; : { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;), &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;keyId&quot; : NumberLong(0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; } } done; run sh.status() If you run sh.status() after adding the shards you will get the below response: mongos&gt;sh.status() --- Sharding Status --- &nbsp; sharding version: { &nbsp; &nbsp; &nbsp; &nbsp; &quot;_id&quot; : 1, &nbsp; &nbsp; &nbsp; &nbsp; &quot;minCompatibleVersion&quot; : 5, &nbsp; &nbsp; &nbsp; &nbsp; &quot;currentVersion&quot; : 6, &nbsp; &nbsp; &nbsp; &nbsp; &quot;clusterId&quot; : ObjectId(&quot;4c90af09e7e0f635a571e413&quot;) &nbsp; } &nbsp; shards: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;a&quot;,&nbsp; &quot;host&quot; : &quot;a/localhost:27000,localhost:27001,localhost:27002&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;b&quot;,&nbsp; &quot;host&quot; : &quot;b/localhost:27100,localhost:27101,localhost:27102&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;c&quot;,&nbsp; &quot;host&quot; : &quot;c/localhost:27200,localhost:27201,localhost:27202&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;d&quot;,&nbsp; &quot;host&quot; : &quot;d/localhost:27300,localhost:27301,localhost:27302&quot;,&nbsp; &quot;state&quot; : 1 } &nbsp; active mongoses: &nbsp; &nbsp; &nbsp; &nbsp; &quot;4.0.6&quot; : 4 &nbsp; autosplit: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled: yes &nbsp; balancer: &nbsp; &nbsp; &nbsp; &nbsp; Currently enabled:&nbsp; yes &nbsp; &nbsp; &nbsp; &nbsp; Currently running:&nbsp; no &nbsp; &nbsp; &nbsp; &nbsp; Failed balancer rounds in last 5 attempts:&nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; Migration Results for the last 24 hours: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No recent migrations &nbsp; databases: &nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; &quot;_id&quot; : &quot;config&quot;,&nbsp; &quot;primary&quot; : &quot;config&quot;,&nbsp; &quot;partitioned&quot; : true }","headline":"JS Script for Shard Setup in Mongo","mainEntityOfPage":{"@type":"WebPage","@id":"https://vemarahub.github.io/vrexploring/js-script-for-shard-setup-in-mongo/"},"url":"https://vemarahub.github.io/vrexploring/js-script-for-shard-setup-in-mongo/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/vrexploring/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://vemarahub.github.io/vrexploring/feed.xml" title="VR Exploring" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/vrexploring/">VR Exploring</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/vrexploring/about/">About</a><a class="page-link" href="/vrexploring/">Home</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">JS Script for Shard Setup in Mongo</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-03-29T14:12:00+00:00" itemprop="datePublished">Mar 29, 2019
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Rajesh Nair</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div dir="ltr" style="text-align: left;" trbidi="on">
Instead of setting up each shard replica set and adding them to shard in the mongos shell we can use the below js script and load it to mongos to add mongo shards without much hassle:<br />
<br />
db = db.getSisterDB("config");<br />
<br />
var mongosConn = db; // assume we connected to a mongos to get going<br />
<br />
var res = null;<br />
<br />
function check() {<br />
&nbsp; &nbsp; &nbsp; &nbsp; printjson(res);<br />
&nbsp; &nbsp; &nbsp; &nbsp; if( !res || !res.ok ) {<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw "check(): not ok, stopping";<br />
&nbsp; &nbsp; &nbsp; &nbsp; }<br />
}<br />
<br />
function waitForSetHealthy() {<br />
&nbsp; &nbsp; &nbsp; &nbsp; print("waiting for repl set initiate to complete...");<br />
&nbsp; &nbsp; &nbsp; &nbsp; while( 1 ) {<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep(250);<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var res = rs.status();<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !res.ok )<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var bad = false;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var i = 0; i &lt; res.members.length; i++ ) {<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var state = res.members[i].state;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( state != 1 &amp;&amp; state != 2 ) // primary or secondary?<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad = true;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if( !bad )<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp; &nbsp; &nbsp; &nbsp; }<br />
}<br />
<br />
function ourAddShard(setname,port) {<br />
&nbsp; &nbsp; &nbsp; &nbsp; db = connect("localhost:"+port+"/test");<br />
&nbsp; &nbsp; &nbsp; &nbsp; print(db.isMaster().me);<br />
&nbsp; &nbsp; &nbsp; &nbsp; res = rs.initiate(<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "_id" : setname,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "members" : [<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 0, host: "localhost:" + port },<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 1, host: "localhost:" + (port+1) },<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { _id: 2, host: "localhost:" + (port+2) }<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp; &nbsp; &nbsp; &nbsp; );<br />
&nbsp; &nbsp; &nbsp; &nbsp; check();<br />
&nbsp; &nbsp; &nbsp; &nbsp; waitForSetHealthy();<br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; print("adding shard...");<br />
&nbsp; &nbsp; &nbsp; &nbsp; db = mongosConn;<br />
&nbsp; &nbsp; &nbsp; &nbsp; res = sh.addShard(setname+"/localhost:"+port);<br />
&nbsp; &nbsp; &nbsp; &nbsp; check();<br />
&nbsp; &nbsp; &nbsp; &nbsp; print("done; run sh.status()");<br />
}<br />
<br />
print("setup.js loaded.");<br />
print("list of existing shards before doing anything:");<br />
printjson( db.shards.find().toArray() );<br />
print()<br />
print("You can invoke:");<br />
print("ourAddShard(setname,port)");<br />
print()<br />
<div>
<br /></div>
<div>
Just save the js to a&nbsp;initiateShard.js file and load to the mongos</div>
<div>
<b>&nbsp;mongo -shell initiateShard.js</b></div>
<div>
<b><br /></b></div>
<div>
Now we can simple add any new shard replica set to existing shards by invoking:</div>
<div>
<br /></div>
<div>
ourAddShard(setname,port)</div>
<div>
<br /></div>
<div>
e g:</div>
<div>
&gt;<b>ourAddShard("d",27300)</b></div>
<div>
<div>
<i>connecting to: mongodb://localhost:27300/test</i></div>
<div>
<i>Implicit session: session { "id" : UUID("666f3569-f12b-4d6b-87bf-58325ec616bb") }</i></div>
<div>
<i>MongoDB server version: 4.0.6</i></div>
<div>
<i>[unknown type]</i></div>
<div>
<i>{</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "ok" : 1,</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "operationTime" : Timestamp(1284551107, 1),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "$clusterTime" : {</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "clusterTime" : Timestamp(1284551107, 1),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "signature" : {</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "keyId" : NumberLong(0)</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; }</i></div>
<div>
<i>}</i></div>
<div>
<i>waiting for repl set initiate to complete...</i></div>
<div>
<i>adding shard...</i></div>
<div>
<i>{</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "shardAdded" : "d",</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "ok" : 1,</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "operationTime" : Timestamp(1284551121, 3),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; "$clusterTime" : {</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "clusterTime" : Timestamp(1284551121, 3),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "signature" : {</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "keyId" : NumberLong(0)</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</i></div>
<div>
<i>&nbsp; &nbsp; &nbsp; &nbsp; }</i></div>
<div>
<i>}</i></div>
<div>
<i>done; run sh.status()</i><br />
<i><br /></i>
If you run sh.status() after adding the shards you will get the below response:<br />
<b>mongos&gt;sh.status()</b><br />
<i>--- Sharding Status ---</i><br />
<i>&nbsp; sharding version: {</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; "_id" : 1,</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; "minCompatibleVersion" : 5,</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; "currentVersion" : 6,</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; "clusterId" : ObjectId("4c90af09e7e0f635a571e413")</i><br />
<i>&nbsp; }</i><br />
<i>&nbsp; shards:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; "_id" : "a",&nbsp; "host" : "a/localhost:27000,localhost:27001,localhost:27002",&nbsp; "state" : 1 }</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; "_id" : "b",&nbsp; "host" : "b/localhost:27100,localhost:27101,localhost:27102",&nbsp; "state" : 1 }</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; "_id" : "c",&nbsp; "host" : "c/localhost:27200,localhost:27201,localhost:27202",&nbsp; "state" : 1 }</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; "_id" : "d",&nbsp; "host" : "d/localhost:27300,localhost:27301,localhost:27302",&nbsp; "state" : 1 }</i><br />
<i>&nbsp; active mongoses:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; "4.0.6" : 4</i><br />
<i>&nbsp; autosplit:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; Currently enabled: yes</i><br />
<i>&nbsp; balancer:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; Currently enabled:&nbsp; yes</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; Currently running:&nbsp; no</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; Failed balancer rounds in last 5 attempts:&nbsp; 0</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; Migration Results for the last 24 hours:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No recent migrations</i><br />
<i>&nbsp; databases:</i><br />
<i>&nbsp; &nbsp; &nbsp; &nbsp; {&nbsp; "_id" : "config",&nbsp; "primary" : "config",&nbsp; "partitioned" : true }</i><br />
<i><br /></i><br />
<div>
<br /></div>
<br /></div>
<div style="font-weight: bold;">
<br /></div>
</div>
</div>

  </div><a class="u-url" href="/vrexploring/js-script-for-shard-setup-in-mongo/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/vrexploring/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">VR Exploring</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">VR Exploring</li><li><a class="u-email" href="mailto:vrexploring@gmail.com">vrexploring@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/vemarahub"><svg class="svg-icon"><use xlink:href="/vrexploring/assets/minima-social-icons.svg#github"></use></svg> <span class="username">vemarahub</span></a></li><li><a href="https://www.twitter.com/vrexploring"><svg class="svg-icon"><use xlink:href="/vrexploring/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">vrexploring</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A space where i share my thoughts and experiences about technology , science, life, family and everything in between.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
